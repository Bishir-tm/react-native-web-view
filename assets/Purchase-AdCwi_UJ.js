import{u,a as m,r as h,I as y,j as e,S as w,aa as l,M as x,a5 as S}from"./index-DQeOCy18.js";import{T as P}from"./TitleCard-BVJXsrCz.js";import{M as p,C as g,b as T}from"./Layout-dtLEbaUA.js";import{F as C,a as E}from"./TrashIcon-DZgiwp0v.js";import{F as k}from"./ArrowPathIcon-B5x0kA_q.js";import{S as D}from"./SearchBar-YkfVzCuZ.js";import"./ErrorText-C3VDSOUb.js";import"./EyeIcon-CIkAS62p.js";const A=({searchQuery:t,setSearchQuery:n})=>{const a=u(),o=()=>{a(x({title:"Add New Purchase",bodyType:p.ADD_PURCHASE,size:"xl"}))};return e.jsxs("div",{className:"flex justify-between w-100 space-x-3",children:[e.jsx(D,{searchText:t,setSearchText:n,placeholderText:"Search purchases...",styleClass:""}),(l("admin")||l("manager"))&&e.jsxs("button",{onClick:o,className:"btn btn-primary",children:[e.jsx(T,{className:"w-6 h-6"})," Add New Purchase"]}),e.jsxs("button",{onClick:()=>location.reload(),className:"btn btn-primary",children:[e.jsx(k,{className:"w-6 h-6"})," Reload"]})]})},R=()=>{const t=u(),n=m(s=>s.purchases.purchases||[]),a=m(s=>s.purchases.status),o=m(s=>s.purchases.error),[j,N]=h.useState("");if(h.useEffect(()=>{a==="idle"&&t(y())},[t,a]),a==="loading")return e.jsx(w,{});const b=n.filter(s=>{var d,i;return[s._id,(d=s==null?void 0:s.supplier)==null?void 0:d.name,s.purchaseDate,(i=s.createdBy)==null?void 0:i.fullname,s.products.map(r=>{var c;return(c=r.productId)==null?void 0:c.name}).join(", ")].join(" ").toLowerCase().includes(j.toLowerCase())}),f=b.length>0?b.map((s,d)=>{const i=s.products.length;return e.jsxs("tr",{className:"border-spacing-x-3 text-center border-collapse ",children:[e.jsx("td",{className:"border-2",children:d+1}),e.jsx("td",{className:"border-2",children:new Date(s.purchaseDate).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,"-")}),e.jsx("td",{className:"border-2",children:`${s.createdBy.fullname} (${s.createdBy.role})`}),e.jsx("td",{className:"border-2",children:s.supplier.name||"Unknown Supplier"}),e.jsxs("td",{className:"border-2",children:[i," -"," ",s.products.map(r=>{var c;return((c=r==null?void 0:r.product)==null?void 0:c.name)+", "})]}),(l("admin")||l("manager"))&&e.jsx("td",{className:"border-2",children:e.jsx("button",{className:"btn btn-sm text-white bg-primary min-w-[70px]",onClick:()=>t(x({title:"Edit Purchase",bodyType:p.EDIT_PURCHASE,extraObject:s,size:"xl"})),children:e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx(C,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden md:block",children:"Edit"})]})})}),l("admin")&&e.jsx("td",{className:"border-2",children:e.jsx("button",{className:"btn btn-sm text-white btn-error min-w-[70px]",onClick:()=>t(x({title:"Delete Purchase?",bodyType:p.CONFIRMATION,extraObject:{message:"Are you sure you want to delete this purchase?",type:g.DELETE_PURCHASE,id:s._id}})),children:e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx(E,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden md:block",children:"Delete"})]})})})]},s._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"13",className:"text-center",children:"No orders found."})});return e.jsx(P,{title:"All Purchases",TopSideButtons:e.jsx(A,{searchQuery:j,setSearchQuery:N}),topMargin:"mt-2",children:e.jsx("div",{className:"overflow-x-auto overflow-y-auto max-h-[500px] w-full",children:e.jsxs("table",{className:"table table-zebra w-full",children:[e.jsx("thead",{className:"bg-base-100 border-b-4 text-md sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border sticky top-0 z-20",children:"#"}),e.jsx("th",{className:"border sticky top-0 z-20",children:"Purchase Date"}),e.jsx("th",{className:"border sticky top-0 z-20",children:"Created By"}),e.jsx("th",{className:"border sticky top-0 z-20",children:"Supplier"}),e.jsx("th",{className:"border sticky top-0 z-20",children:"Total Products"}),e.jsx("th",{className:"border sticky top-0 z-20",children:"Edit"}),e.jsx("th",{className:"border sticky top-0 z-20",children:"Delete"})]})}),e.jsx("tbody",{children:n.length>0?f:o?o.message:e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center",children:"No purchases found."})})})]})})})};function v(){const t=u();return h.useEffect(()=>{t(S({title:"Purchase"}))},[]),e.jsx(R,{})}export{v as default};
